FROM debian:12

###############################################################################################################################################################################################################################
# Root #
########
RUN echo root:admin | chpasswd

###############################################################################################################################################################################################################################
# Install systemd #
###################
RUN apt update
RUN apt upgrade -y

###############################################################################################################################################################################################################################
# Install Package #
###################
RUN apt install -y \
bash \
bash-completion \
nano \
net-tools \
openssh-server \
systemd \
systemd-sysv

###############################################################################################################################################################################################################################
# Create the directory for systemd configuration overrides #
############################################################
RUN mkdir -p /etc/systemd/system.conf.d/

###############################################################################################################################################################################################################################
# Configure systemd to start automatically #
############################################
RUN echo "[Install]" > /etc/systemd/system.conf.d/override.conf
RUN echo " systemctl daemon-reexec" >> /etc/systemd/system.conf.d/override.conf

###############################################################################################################################################################################################################################
# SSH #
#######
RUN sed -i -e "s/^#PermitRootLogin prohibit-password/PermitRootLogin yes/g" /etc/ssh/sshd_config;
RUN sed -i -e "s/^#Port 22/Port 222/g" /etc/ssh/sshd_config;

###############################################################################################################################################################################################################################
# Expose #
##########
EXPOSE 22

###############################################################################################################################################################################################################################
# Set the default command to run systemd
#CMD ["/sbin/init"]
CMD ["systemd", "--system=/sysroot", "start", "multi-user.target"]
